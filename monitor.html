<!DOCTYPE html>
<html lang="zh-CN" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI å…¨ç½‘åŸå§‹å±€åŠ¿ç›‘æ§ | Insight Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'], serif: ['"Noto Serif SC"', 'serif'] } } }
        }
    </script>
    <style>
        body {
            background-color: #f8fafc;
            color: #1e293b;
            font-family: 'Inter', sans-serif;
        }

        .dark body {
            background-color: #0f172a;
            color: #f1f5f9;
        }

        [v-cloak] {
            display: none;
        }

        .thin-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .thin-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 9999px;
        }

        .dark .thin-scrollbar::-webkit-scrollbar-thumb {
            background-color: #334155;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .list-enter-active,
        .list-leave-active {
            transition: all 0.3s ease;
        }

        .list-enter-from,
        .list-leave-to {
            opacity: 0;
            transform: scale(0.95);
        }
    </style>
</head>

<body class="h-full flex overflow-hidden selection:bg-blue-500 selection:text-white">

    <div id="app" v-cloak class="flex w-full h-full relative transition-colors duration-300">
        <!-- Sidebar logic (Shared) -->
        <div v-if="isMobileMenuOpen" @click="isMobileMenuOpen = false"
            class="fixed inset-0 bg-black/50 z-30 md:hidden backdrop-blur-sm transition-opacity"></div>
        <aside
            :class="['fixed md:static inset-y-0 left-0 z-40 w-64 transform transition-transform duration-300 ease-in-out flex flex-col border-r shadow-2xl md:shadow-none', currentTheme.sidebarBg, currentTheme.sidebarBorder, isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0']">
            <div class="p-6 flex items-center justify-between gap-3">
                <div class="flex items-center gap-3">
                    <div
                        :class="['w-10 h-10 rounded-xl flex items-center justify-center text-xl shadow-lg', currentTheme.logoBg, currentTheme.logoText]">
                        <i class="fa-solid fa-brain"></i>
                    </div>
                    <div>
                        <h1 :class="['font-bold text-lg', currentTheme.sidebarText]">Insight Pro</h1>
                        <p class="text-[10px] opacity-60 uppercase tracking-wider">AI Powered Analytics</p>
                    </div>
                </div>
                <button @click="isMobileMenuOpen = false" class="md:hidden text-slate-400"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <nav class="flex-1 px-4 space-y-2 py-4">
                <div class="text-xs font-bold uppercase tracking-wider opacity-50 mb-3 px-2"
                    :class="currentTheme.sidebarText">æ ¸å¿ƒè§†å›¾</div>
                <a href="index.html" :class="navBtnClass('smart')"><i class="fa-solid fa-chart-pie w-5 opacity-70"></i>
                    æ™ºèƒ½æ·±åº¦ç®€æŠ¥</a>
                <a href="monitor.html" :class="navBtnClass('raw')"><i
                        class="fa-solid fa-tower-broadcast w-5 opacity-70"></i> åŸå§‹æ•°æ®ç›‘æ§</a>
                <div class="my-4 border-t border-slate-200 dark:border-slate-800 opacity-50"></div>
                <a href="about.html" :class="navBtnClass('contact')"><i
                        class="fa-solid fa-circle-info w-5 opacity-70"></i> è¯´æ˜/è”ç³»/åŠ ç¾¤</a>
            </nav>
            <div class="p-4 border-t" :class="currentTheme.sidebarBorder">
                <button @click="toggleDarkMode"
                    :class="['w-full flex items-center justify-center gap-2 py-2 rounded-lg transition-colors', currentTheme.sidebarHover, currentTheme.sidebarText]">
                    <i :class="['fa-solid', isDarkMode ? 'fa-sun' : 'fa-moon']"></i><span class="text-sm">{{ isDarkMode
                        ? 'åˆ‡æ¢æ—¥é—´æ¨¡å¼' : 'åˆ‡æ¢æ·±è‰²æ¨¡å¼' }}</span>
                </button>
            </div>
        </aside>

        <main
            :class="['flex-1 flex flex-col h-full overflow-hidden relative transition-colors duration-300 w-full', currentTheme.mainBg]">
            <div
                class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white text-[10px] md:text-xs text-center py-1 font-bold z-20">
                æ¯å¤©ä¸ƒç‚¹æ›´æ–°AIç®€æŠ¥ï¼Œæ¯ä¸‰ååˆ†é’Ÿæ›´æ–°ä¸€æ¬¡åŸå§‹æ•°æ®ç›‘æ§
            </div>

            <header
                :class="['h-16 shrink-0 border-b flex items-center justify-between px-4 md:px-8 backdrop-blur-md z-10 transition-colors duration-300', currentTheme.headerBg, currentTheme.headerBorder]">
                <div class="flex items-center gap-4">
                    <button @click="isMobileMenuOpen = true"
                        class="md:hidden text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"><i
                            class="fa-solid fa-bars text-xl"></i></button>
                    <h2 class="text-lg md:text-xl font-bold flex items-center gap-2 transition-colors duration-300 truncate"
                        :class="currentTheme.headerText">
                        <i class="fa-solid fa-tower-broadcast text-xl md:text-2xl text-blue-500"></i>
                        <span class="truncate">å…¨ç½‘åŸå§‹æ•°æ®ç›‘æ§å°</span>
                    </h2>
                </div>

                <!-- Time Machine & Time Ago -->
                <div class="flex items-center gap-3">
                    <div
                        class="hidden md:flex items-center gap-1.5 px-3 py-1 text-xs font-medium rounded-full bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-700">
                        <i class="fa-regular fa-clock"></i> {{ timeAgo }}
                    </div>

                    <div class="flex items-center gap-3">
                        <button @click="showTimeMachine = true"
                            class="flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold transition-all border group"
                            :class="[isHistoryMode ? 'bg-blue-500 text-white border-blue-500 shadow-lg shadow-blue-500/30' : 'bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border-slate-200 dark:border-slate-700 hover:border-blue-500 hover:text-blue-500']">
                            <i class="fa-solid fa-clock-rotate-left" :class="{'animate-spin-reverse': loading}"></i>
                            <span v-if="isHistoryMode">{{ currentHistoryLabel }}</span>
                            <span v-else>å†å²æ—¶å…‰æœº</span>
                            <i v-if="isHistoryMode" @click.stop="resetToLatest"
                                class="fa-solid fa-times ml-1 opacity-60 hover:opacity-100" title="è¿”å›æœ€æ–°"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Time Machine Modal -->
            <transition name="list">
                <div v-if="showTimeMachine"
                    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm"
                    @click="showTimeMachine = false">
                    <div class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-4xl max-h-[80vh] flex flex-col shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-800"
                        @click.stop>

                        <!-- Modal Header -->
                        <div
                            class="p-4 md:p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-slate-50/50 dark:bg-slate-800/50">
                            <div>
                                <h3 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2">
                                    <i class="fa-solid fa-timeline text-blue-500"></i> æ•°æ®å†å²æ—¶å…‰æœº
                                </h3>
                                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">è¿½æº¯è¿‡å¾€çš„åŸå§‹æ•°æ®é‡‡é›†è®°å½•</p>
                            </div>
                            <button @click="showTimeMachine = false"
                                class="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-800 text-slate-500 flex items-center justify-center hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </div>

                        <!-- Modal Body -->
                        <div class="flex-1 flex overflow-hidden">
                            <!-- Left: Date List -->
                            <div
                                class="w-1/3 md:w-64 border-r border-slate-100 dark:border-slate-800 overflow-y-auto thin-scrollbar bg-slate-50 dark:bg-slate-900">
                                <div class="p-2 space-y-1">
                                    <button @click="selectedDate = 'all'"
                                        :class="['w-full text-left px-4 py-3 rounded-lg text-sm font-bold flex justify-between items-center transition-all', selectedDate === 'all' ? 'bg-blue-500 text-white shadow-md shadow-blue-500/20' : 'text-slate-600 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-800']">
                                        <span>ğŸ“… æ‰€æœ‰æ—¥æœŸ</span>
                                        <span
                                            class="text-xs opacity-60 bg-black/10 dark:bg-white/10 px-1.5 rounded-full">{{
                                            historyIndex.length }}</span>
                                    </button>
                                    <div class="my-2 border-t border-slate-200 dark:border-slate-800 mx-2"></div>
                                    <button v-for="date in uniqueDates" :key="date" @click="selectedDate = date"
                                        :class="['w-full text-left px-4 py-3 rounded-lg text-sm font-medium transition-all', selectedDate === date ? 'bg-white dark:bg-slate-800 text-blue-600 dark:text-blue-400 shadow-sm ring-1 ring-slate-200 dark:ring-slate-700' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-200/50 dark:hover:bg-slate-800/50']">
                                        {{ date }}
                                    </button>
                                </div>
                            </div>

                            <!-- Right: Time Slots -->
                            <div class="flex-1 overflow-y-auto p-4 md:p-6 bg-white dark:bg-slate-900/50 thin-scrollbar">
                                <div v-if="filteredHistory.length === 0"
                                    class="h-full flex flex-col items-center justify-center text-slate-400 opacity-60">
                                    <i class="fa-regular fa-folder-open text-4xl mb-3"></i>
                                    <p class="text-sm">è¯¥æ—¥æœŸæš‚æ— å­˜æ¡£æ•°æ®</p>
                                </div>

                                <div v-else class="space-y-6">
                                    <!-- Group by Date Section -->
                                    <div v-for="(group, date) in groupedFilteredHistory" :key="date">
                                        <h4 v-if="selectedDate === 'all'"
                                            class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 pl-1 sticky top-0 bg-white dark:bg-slate-900 py-2 z-10">
                                            {{ date }}</h4>

                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            <button v-for="item in group" :key="item.path" @click="selectHistory(item)"
                                                class="relative overflow-hidden p-4 rounded-xl border border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 hover:border-blue-500 hover:shadow-md dark:hover:border-blue-500 transition-all text-left group">

                                                <div
                                                    class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity transform group-hover:scale-110">
                                                    <i :class="['fa-solid text-4xl', getTimeIcon(item.time)]"></i>
                                                </div>

                                                <div class="relative z-10">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <span
                                                            :class="['px-1.5 py-0.5 rounded text-[10px] font-bold border', getTimeBadgeClass(item.time)]">
                                                            {{ getTimeLabel(item.time) }}
                                                        </span>
                                                        <span class="text-xs font-mono text-slate-400">{{ item.time
                                                            }}</span>
                                                    </div>
                                                    <div
                                                        class="text-sm font-bold text-slate-700 dark:text-slate-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                                                        åŸå§‹æ•°æ®å½’æ¡£
                                                    </div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>

            <div
                class="flex-1 flex flex-col md:flex-row overflow-hidden bg-slate-100 dark:bg-slate-900 transition-colors duration-300">
                <!-- Source Filter Sidebar -->
                <div
                    class="w-full md:w-48 bg-white dark:bg-slate-800 border-b md:border-b-0 md:border-r border-slate-200 dark:border-slate-700 flex flex-col shrink-0 transition-colors duration-300">
                    <div class="p-3 md:p-4">
                        <h3 class="hidden md:block text-xs font-bold uppercase text-slate-400 mb-4 px-2">æ¥æºåˆ†ç±»</h3>
                        <div
                            class="flex items-center gap-2 overflow-x-auto hide-scrollbar pb-1 md:pb-0 md:flex-col md:gap-1 md:items-stretch">
                            <button @click="rawCategory = 'all'" :class="rawNavClass('all') + ' shrink-0'"><span><i
                                        class="fa-solid fa-border-all mr-2 opacity-70"></i>å…¨éƒ¨</span><span
                                    class="text-xs opacity-50 bg-black/5 dark:bg-white/5 px-1.5 rounded-full ml-2">{{
                                    totalRawSources }}</span></button>
                            <button @click="rawCategory = 'fav'" :class="rawNavClass('fav') + ' shrink-0'"><span><i
                                        class="fa-solid fa-star mr-2 opacity-70 text-yellow-500"></i>æ”¶è—</span><span
                                    class="text-xs opacity-50 bg-black/5 dark:bg-white/5 px-1.5 rounded-full ml-2">{{
                                    favoriteIds.size }}</span></button>
                            <div class="hidden md:block my-4 border-t border-slate-100 dark:border-slate-700"></div>
                            <button v-for="(count, cat) in rawCategoryCounts" :key="cat" @click="rawCategory = cat"
                                :class="rawNavClass(cat) + ' shrink-0'">
                                <span><i :class="['fa-solid mr-2 opacity-70', getCategoryIcon(cat)]"></i><span
                                        class="capitalize">{{cat}}</span></span><span class="text-xs opacity-50 ml-2">{{
                                    count }}</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="flex-1 flex flex-col overflow-hidden">
                    <div
                        class="p-3 md:p-4 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex items-center justify-between transition-colors duration-300">
                        <div class="relative w-full md:w-96"><i
                                class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i><input
                                v-model="searchText" type="text" placeholder="æœç´¢æ¥æº (å¦‚: å¾®åš, 36kr)..."
                                class="w-full pl-10 pr-4 py-2 bg-slate-100 dark:bg-slate-900 border-transparent focus:border-blue-500 focus:bg-white dark:focus:bg-slate-950 rounded-lg text-sm transition-all outline-none dark:text-slate-200 placeholder-slate-400">
                        </div>
                        <div class="hidden md:block text-sm text-slate-500">æ˜¾ç¤º {{ filteredRawList.length }} ä¸ªæ¥æº</div>
                    </div>

                    <div
                        class="flex-1 overflow-y-auto p-4 md:p-6 thin-scrollbar bg-slate-50 dark:bg-slate-900 transition-colors duration-300">
                        <div v-if="loading" class="flex justify-center py-20"><i
                                class="fa-solid fa-circle-notch fa-spin text-3xl opacity-50"></i></div>
                        <div v-else
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 items-start">
                            <div v-for="platform in filteredRawList" :key="platform.id"
                                class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col overflow-hidden hover:shadow-md transition-shadow group">
                                <div
                                    class="p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50 flex justify-between items-center shrink-0">
                                    <div
                                        class="font-bold text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200">
                                        <span class="w-2.5 h-2.5 rounded-full"
                                            :class="getCategoryColorClass(platform.category)"></span>
                                        <span class="truncate max-w-[150px] md:max-w-[120px]" :title="platform.id">{{
                                            getDisplayName(platform.id) }}</span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span
                                            class="text-[10px] font-medium bg-slate-200 dark:bg-slate-700 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400">{{
                                            platform.items.length }}</span>
                                        <button @click.stop="toggleFavorite(platform.id)"
                                            class="text-lg transition-transform active:scale-125 hover:scale-110">
                                            <i
                                                :class="['fa-star', isFavorite(platform.id) ? 'fa-solid text-yellow-400' : 'fa-regular text-slate-300 hover:text-yellow-400']"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="p-3 overflow-y-auto thin-scrollbar" style="max-height: 320px;">
                                    <ul class="space-y-2.5">
                                        <li v-for="(news, idx) in platform.items" :key="idx" class="group/item">
                                            <a :href="news.url" target="_blank" @click.stop
                                                class="flex gap-2 items-start leading-tight">
                                                <span
                                                    class="text-[10px] text-slate-400 font-mono pt-0.5 w-4 shrink-0">{{
                                                    idx + 1 }}.</span>
                                                <span
                                                    class="text-xs text-slate-600 dark:text-slate-300 group-hover/item:text-blue-600 dark:group-hover/item:text-blue-400 group-hover/item:underline break-words">{{
                                                    news.title }}</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, reactive, computed, ref, onMounted } = Vue
        createApp({
            setup() {
                const loading = ref(true);
                const isDarkMode = ref(false);
                const isMobileMenuOpen = ref(false);
                const rawCategory = ref('all');
                const searchText = ref('');

                // Time Machine State
                const showTimeMachine = ref(false);
                const isHistoryMode = ref(false);
                const currentHistoryLabel = ref('');
                const selectedDate = ref('all');

                // History
                const historyIndex = ref([]);
                const lastUpdateTime = ref(new Date());

                const uniqueDates = computed(() => {
                    const dates = new Set(historyIndex.value.map(h => h.display.split(' ')[0]));
                    return Array.from(dates).sort().reverse();
                });

                const filteredHistory = computed(() => {
                    let list = historyIndex.value;
                    if (selectedDate.value !== 'all') {
                        list = list.filter(h => h.display.startsWith(selectedDate.value));
                    }
                    return list.map(h => {
                        const [d, t] = h.display.split(' ');
                        return { ...h, date: d, time: t };
                    });
                });

                const groupedFilteredHistory = computed(() => {
                    const groups = {};
                    filteredHistory.value.forEach(item => {
                        if (!groups[item.date]) groups[item.date] = [];
                        groups[item.date].push(item);
                    });
                    return groups;
                });

                const rawData = reactive({ finance: [], global: [], tech: [], general: [] });
                const favoriteIds = reactive(new Set());

                const platformMap = { 'douyin': 'æŠ–éŸ³', 'zhihu': 'çŸ¥ä¹', 'weibo': 'å¾®åš', 'bilibili-hot-search': 'Bç«™çƒ­æœ', 'baidu': 'ç™¾åº¦çƒ­æœ', 'toutiao': 'ä»Šæ—¥å¤´æ¡', 'tieba': 'ç™¾åº¦è´´å§', '36kr-quick': '36æ°ªå¿«è®¯', '36kr-renqi': '36æ°ªäººæ°”', 'wallstreetcn-hot': 'åå°”è¡—è§é—»', 'wallstreetcn-news': 'åå°”è¡—èµ„è®¯', 'wallstreetcn-quick': 'åå°”è¡—å¿«è®¯', 'cls-hot': 'è´¢è”ç¤¾çƒ­é—¨', 'cls-depth': 'è´¢è”ç¤¾æ·±åº¦', 'xueqiu-hotstock': 'é›ªçƒçƒ­è‚¡', 'gelonghui': 'æ ¼éš†æ±‡', 'jin10': 'é‡‘åæ•°æ®', 'thepaper': 'æ¾æ¹ƒæ–°é—»', 'sspai': 'å°‘æ•°æ´¾', 'ithome': 'ITä¹‹å®¶', 'huxiu': 'è™å—…', 'geekpark': 'æå®¢å…¬å›­', 'zaobao': 'è”åˆæ—©æŠ¥', 'cankaoxiaoxi': 'å‚è€ƒæ¶ˆæ¯', 'fastbull-express': 'æ³•å¸ƒè´¢ç»', 'douban': 'è±†ç“£', 'hupu': 'è™æ‰‘', 'steam': 'Steam', 'v2ex-share': 'V2EX', 'solidot': 'Solidot', 'hackernews': 'HackerNews', 'github-trending-today': 'GitHub æ¦œ', 'producthunt': 'ProductHunt' };

                async function safeFetch(url) {
                    try { const res = await fetch(url); return res.ok ? await res.json() : []; } catch (e) { return []; }
                }

                const loadHistoryData = async (path) => {
                    loading.value = true;
                    // Support both "latest" string and full path logic
                    const basePath = (!path || path === 'latest') ? './' : `./${path}`;
                    const t = new Date().getTime();

                    const [f, g, tc, gen] = await Promise.all([
                        safeFetch(`${basePath}data_finance.json?t=${t}`),
                        safeFetch(`${basePath}data_global.json?t=${t}`),
                        safeFetch(`${basePath}data_tech.json?t=${t}`),
                        safeFetch(`${basePath}data_general.json?t=${t}`)
                    ]);

                    rawData.finance = f; rawData.global = g; rawData.tech = tc; rawData.general = gen;

                    // Parse Time for "updated X mins ago"
                    if (path && path !== 'latest') {
                        // Extract from path archives/raw/YYYY-MM-DD/HH-mm/
                        const parts = path.split('/');
                        if (parts.length >= 4) {
                            const dateStr = parts[2]; // YYYY-MM-DD
                            const timeStr = parts[3]; // HH-mm
                            lastUpdateTime.value = new Date(`${dateStr}T${timeStr.replace('-', ':')}:00`);
                        }
                    } else {
                        lastUpdateTime.value = new Date(); // Approximate "now" if latest
                    }
                    loading.value = false;
                };

                const selectHistory = async (item) => {
                    isHistoryMode.value = true;
                    currentHistoryLabel.value = `ğŸ•’ ${item.display}`;
                    showTimeMachine.value = false;
                    await loadHistoryData(item.path);
                };

                const resetToLatest = async () => {
                    isHistoryMode.value = false;
                    currentHistoryLabel.value = '';
                    await loadHistoryData('latest');
                };

                // Helpers
                const getTimeIcon = (time) => {
                    const hour = parseInt(time.split(':')[0]);
                    if (hour >= 5 && hour < 10) return 'fa-mug-hot text-amber-500';
                    if (hour >= 10 && hour < 14) return 'fa-sun text-orange-500';
                    if (hour >= 14 && hour < 19) return 'fa-cloud-sun text-blue-400';
                    return 'fa-moon text-indigo-400';
                };

                const getTimeLabel = (time) => {
                    const hour = parseInt(time.split(':')[0]);
                    if (hour >= 5 && hour < 10) return 'æ—©é—´æ›´æ–°';
                    if (hour >= 10 && hour < 14) return 'åˆé—´æ›´æ–°';
                    if (hour >= 14 && hour < 19) return 'æ™šé—´æ›´æ–°';
                    return 'å¤œé—´æ›´æ–°';
                };

                const getTimeBadgeClass = (time) => {
                    const hour = parseInt(time.split(':')[0]);
                    if (hour >= 5 && hour < 10) return 'bg-amber-100 text-amber-900 dark:bg-amber-900/40 dark:text-amber-300 border-amber-200 dark:border-amber-700';
                    if (hour >= 10 && hour < 14) return 'bg-orange-100 text-orange-900 dark:bg-orange-900/40 dark:text-orange-300 border-orange-200 dark:border-orange-700';
                    return 'bg-blue-100 text-blue-900 dark:bg-blue-900/40 dark:text-blue-300 border-blue-200 dark:border-blue-700';
                };


                const timeAgo = computed(() => {
                    const now = new Date();
                    const diffMs = now - lastUpdateTime.value;
                    const diffMins = Math.floor(diffMs / 60000);
                    if (diffMins < 1) return 'åˆšåˆšæ›´æ–°';
                    if (diffMins < 60) return `${diffMins} åˆ†é’Ÿå‰æ›´æ–°`;
                    const diffHours = Math.floor(diffMins / 60);
                    if (diffHours < 24) return `${diffHours} å°æ—¶å‰æ›´æ–°`;
                    return `${Math.floor(diffHours / 24)} å¤©å‰æ›´æ–°`;
                });

                onMounted(async () => {
                    const dark = localStorage.getItem('darkMode'); if (dark === 'true') { isDarkMode.value = true; document.documentElement.classList.add('dark'); }
                    const fav = localStorage.getItem('favorites'); if (fav) new Set(JSON.parse(fav)).forEach(id => favoriteIds.add(id));

                    try {
                        const indexRes = await fetch('./history/raw_index.json');
                        if (indexRes.ok) historyIndex.value = await indexRes.json();
                    } catch (e) { }

                    await loadHistoryData('latest');
                });

                const currentTheme = computed(() => {
                    const dark = isDarkMode.value;
                    return {
                        sidebarBg: dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200',
                        sidebarText: dark ? 'text-slate-100' : 'text-slate-800',
                        sidebarBorder: dark ? 'border-slate-800' : 'border-slate-200',
                        sidebarHover: dark ? 'hover:bg-slate-800' : 'hover:bg-slate-100',
                        headerBg: dark ? 'bg-slate-900/80' : 'bg-white/80',
                        headerBorder: dark ? 'border-slate-800' : 'border-slate-200',
                        headerText: dark ? 'text-slate-100' : 'text-slate-800',
                        mainBg: dark ? 'bg-[#0f172a]' : 'bg-[#f8fafc]',
                        logoBg: 'bg-slate-200 text-slate-600', logoText: ''
                    };
                });

                const navBtnClass = (page) => `w-full text-left px-4 py-3 rounded-xl flex items-center gap-4 transition-all font-medium ${page === 'raw' ? (isDarkMode.value ? 'bg-slate-800 text-white shadow-inner' : 'bg-slate-100 text-slate-900 shadow-sm') : (isDarkMode.value ? 'text-slate-400 hover:bg-slate-800/50' : 'text-slate-500 hover:bg-slate-50')}`;
                const rawNavClass = (cat) => `w-full text-left px-3 py-2 rounded-lg text-sm font-medium flex items-center justify-between transition-colors capitalize ${rawCategory.value === cat ? 'bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700'}`;

                const allPlatformList = computed(() => [
                    ...rawData.finance.map(i => ({ ...i, category: 'finance' })),
                    ...rawData.global.map(i => ({ ...i, category: 'global' })),
                    ...rawData.tech.map(i => ({ ...i, category: 'tech' })),
                    ...rawData.general.map(i => ({ ...i, category: 'general' }))
                ]);

                const filteredRawList = computed(() => {
                    let allRaw = allPlatformList.value;
                    if (rawCategory.value === 'fav') allRaw = allRaw.filter(item => favoriteIds.has(item.id));
                    else if (rawCategory.value !== 'all') allRaw = allRaw.filter(item => item.category === rawCategory.value);
                    if (searchText.value.trim()) {
                        const key = searchText.value.toLowerCase();
                        allRaw = allRaw.filter(item => (platformMap[item.id] || item.id).toLowerCase().includes(key) || item.id.toLowerCase().includes(key));
                    }
                    return allRaw;
                });

                const rawCategoryCounts = computed(() => ({ finance: rawData.finance.length, global: rawData.global.length, tech: rawData.tech.length, general: rawData.general.length }));
                const totalRawSources = computed(() => Object.values(rawCategoryCounts.value).reduce((a, b) => a + b, 0));

                const toggleDarkMode = () => { isDarkMode.value = !isDarkMode.value; document.documentElement.classList.toggle('dark', isDarkMode.value); localStorage.setItem('darkMode', isDarkMode.value); };
                const isFavorite = (id) => favoriteIds.has(id);
                const toggleFavorite = (id) => { favoriteIds.has(id) ? favoriteIds.delete(id) : favoriteIds.add(id); localStorage.setItem('favorites', JSON.stringify([...favoriteIds])); };
                const getDisplayName = (id) => platformMap[id] || id;
                const getCategoryIcon = (cat) => ({ finance: 'fa-coins', global: 'fa-globe', tech: 'fa-microchip', general: 'fa-fire' }[cat] || 'fa-circle');
                const getCategoryColorClass = (cat) => ({ finance: 'bg-amber-500', global: 'bg-blue-500', tech: 'bg-cyan-500', general: 'bg-rose-500' }[cat] || 'bg-slate-500');

                return {
                    loading, isDarkMode, isMobileMenuOpen, rawCategory, searchText,
                    showTimeMachine, isHistoryMode, currentHistoryLabel, selectedDate, uniqueDates, filteredHistory, groupedFilteredHistory,
                    selectHistory, resetToLatest, getTimeIcon, getTimeLabel, getTimeBadgeClass,
                    historyIndex, loadHistoryData, timeAgo,
                    currentTheme, navBtnClass, rawNavClass, toggleDarkMode,
                    filteredRawList, rawCategoryCounts, totalRawSources, favoriteIds, isFavorite, toggleFavorite,
                    getCategoryIcon, getCategoryColorClass, getDisplayName
                }
            }
        }).mount('#app')
    </script>
</body>

</html>
