<!DOCTYPE html>
<html lang="zh-CN" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI å…¨ç½‘èˆ†æƒ…æ™ºåº“ | Insight Pro</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@700&family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['"Noto Serif SC"', 'serif'],
                        cyber: ['Orbitron', 'sans-serif'],
                    },
                    animation: {
                        'pulse-neon': 'pulse-neon 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f8fafc; color: #1e293b; font-family: 'Inter', sans-serif; }
        .dark body { background-color: #0f172a; color: #f1f5f9; }
        [v-cloak] { display: none; }
        .thin-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .thin-scrollbar::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 9999px; }
        .dark .thin-scrollbar::-webkit-scrollbar-thumb { background-color: #334155; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .read-item { opacity: 0.6; filter: grayscale(100%); transition: all 0.3s ease; }
        .cyber-border { position: relative; background: linear-gradient(90deg, #22d3ee, #a855f7); padding: 1px; }
        .cyber-inner { background-color: #020617; height: 100%; width: 100%; }
        .ent-card { background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.4)); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); }
        .dark .ent-card { background: linear-gradient(135deg, rgba(30,41,59,0.8), rgba(15,23,42,0.6)); border-color: rgba(255,255,255,0.05); }
        
        /* ä¸‹æ‹‰èœå•åŠ¨ç”» */
        .menu-enter-active, .menu-leave-active { transition: all 0.2s ease; }
        .menu-enter-from, .menu-leave-to { opacity: 0; transform: scale(0.95); }
    </style>
</head>
<body class="h-full flex overflow-hidden selection:bg-blue-500 selection:text-white" @click="closeAllMenus">

<div id="app" v-cloak class="flex w-full h-full relative transition-colors duration-300">

    <div v-if="isMobileMenuOpen" @click="isMobileMenuOpen = false" class="fixed inset-0 bg-black/50 z-30 md:hidden backdrop-blur-sm transition-opacity"></div>

    <aside :class="['fixed md:static inset-y-0 left-0 z-40 w-64 transform transition-transform duration-300 ease-in-out flex flex-col border-r shadow-2xl md:shadow-none', 
        isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0',
        currentTheme.sidebarBg, currentTheme.sidebarBorder]">
        
        <div class="p-6 flex items-center justify-between gap-3">
            <div class="flex items-center gap-3">
                <div :class="['w-10 h-10 rounded-xl flex items-center justify-center text-xl shadow-lg transition-colors duration-300', currentTheme.logoBg, currentTheme.logoText]">
                    <i class="fa-solid fa-brain"></i>
                </div>
                <div>
                    <h1 :class="['font-bold text-lg leading-tight', currentTheme.sidebarText]">Insight Pro</h1>
                    <p class="text-[10px] opacity-60 uppercase tracking-wider">AI Powered Analytics</p>
                </div>
            </div>
            <button @click="isMobileMenuOpen = false" class="md:hidden text-slate-400 hover:text-slate-600">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
        </div>

        <nav class="flex-1 px-4 space-y-2 py-4">
            <div class="text-xs font-bold uppercase tracking-wider opacity-50 mb-3 px-2" :class="currentTheme.sidebarText">æ ¸å¿ƒè§†å›¾</div>
            <button @click="switchView('smart')" :class="navBtnClass('smart')">
                <i class="fa-solid fa-chart-pie w-5 opacity-70"></i> æ™ºèƒ½æ·±åº¦ç®€æŠ¥
            </button>
            <button @click="switchView('raw')" :class="navBtnClass('raw')">
                <i class="fa-solid fa-tower-broadcast w-5 opacity-70"></i> åŸå§‹æ•°æ®ç›‘æ§
            </button>
            <div class="my-4 border-t border-slate-200 dark:border-slate-800 opacity-50"></div>
            <button @click="switchView('contact')" :class="navBtnClass('contact')">
                <i class="fa-solid fa-circle-info w-5 opacity-70"></i> è¯´æ˜/è”ç³»/åŠ ç¾¤
            </button>
        </nav>
        
        <div class="p-4 border-t" :class="currentTheme.sidebarBorder">
            <button @click="toggleDarkMode" :class="['w-full flex items-center justify-center gap-2 py-2 rounded-lg transition-colors', currentTheme.sidebarHover, currentTheme.sidebarText]">
                <i :class="['fa-solid', isDarkMode ? 'fa-sun' : 'fa-moon']"></i>
                <span class="text-sm">{{ isDarkMode ? 'åˆ‡æ¢æ—¥é—´æ¨¡å¼' : 'åˆ‡æ¢æ·±è‰²æ¨¡å¼' }}</span>
            </button>
        </div>
    </aside>

    <main :class="['flex-1 flex flex-col h-full overflow-hidden relative transition-colors duration-300 w-full', currentTheme.mainBg]">
        
        <header :class="['h-16 shrink-0 border-b flex items-center justify-between px-4 md:px-8 backdrop-blur-md z-10 transition-colors duration-300', currentTheme.headerBg, currentTheme.headerBorder]">
            <div class="flex items-center gap-4">
                <button @click="isMobileMenuOpen = true" class="md:hidden text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>

                <h2 class="text-lg md:text-xl font-bold flex items-center gap-2 md:gap-3 transition-colors duration-300 truncate" :class="currentTheme.headerText">
                    <template v-if="currentView === 'contact'">
                        <i class="fa-solid fa-book-open-reader text-indigo-500 text-xl md:text-2xl"></i> å…³äº Insight Pro
                    </template>
                    <template v-else>
                        <i v-if="currentView === 'smart'" :class="['fa-solid text-xl md:text-2xl', currentSmartTabIcon]"></i>
                        <i v-else class="fa-solid fa-satellite-dish text-xl md:text-2xl text-blue-500"></i>
                        <span class="truncate">{{ currentViewTitle }}</span>
                    </template>
                </h2>
            </div>

            <div class="flex items-center gap-3">
                 <div class="flex items-center gap-2 text-xs font-mono px-2 py-1 md:px-3 md:py-1 rounded-full bg-green-500/10 text-green-600 dark:text-green-400 border border-green-500/20">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span class="hidden md:inline">å½“å‰åœ¨çº¿:</span> {{ onlineUsers }} <span class="hidden md:inline">äºº</span>
                </div>
                <div v-if="loading" class="hidden md:flex items-center gap-2 text-sm opacity-70" :class="currentTheme.headerText">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> åŒæ­¥ä¸­...
                </div>
                <div v-else class="hidden md:block text-xs font-medium px-3 py-1.5 rounded-full bg-black/5 dark:bg-white/10" :class="currentTheme.headerText">
                   <i class="fa-regular fa-clock mr-1"></i> {{ lastUpdateTime || 'åˆšåˆš' }}
                </div>
            </div>
        </header>

        <div v-if="currentView === 'smart'" class="flex-1 flex flex-col overflow-hidden">
            <div :class="['shrink-0 px-4 md:px-8 pt-2 md:pt-4 pb-0 flex gap-4 md:gap-6 border-b text-sm font-medium transition-colors duration-300 overflow-x-auto hide-scrollbar', currentTheme.tabBorder]">
                <button v-for="tab in smartTabs" :key="tab.id" @click="currentSmartTab = tab.id" :class="['pb-3 relative transition-all flex items-center gap-2 shrink-0 whitespace-nowrap', currentSmartTab === tab.id ? tab.activeClass + ' border-b-2' : 'opacity-50 hover:opacity-100 border-transparent text-slate-500 dark:text-slate-400']"><i :class="['fa-solid', tab.icon]"></i> {{ tab.name }}<span v-if="currentSmartTab === 'tech' && tab.id === 'tech'" class="absolute bottom-0 left-0 w-full h-0.5 bg-cyan-400 shadow-[0_0_10px_#22d3ee]"></span></button>
            </div>
            <div class="flex-1 overflow-y-auto p-4 md:p-8 thin-scrollbar scroll-smooth">
                <div v-if="currentSmartData?.error" class="mb-8 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg flex items-center gap-3"><i class="fa-solid fa-triangle-exclamation text-xl"></i><div><p class="font-bold">æ•°æ®åŠ è½½å¤±è´¥</p><p class="text-xs opacity-75">åŸå› : {{ currentSmartData.error }}</p></div></div>
                
                <div v-if="computedSummary" :class="['p-5 md:p-6 rounded-2xl mb-6 md:mb-8 shadow-xl relative overflow-hidden transition-all duration-300', currentTheme.summaryCard]"><div class="absolute top-0 right-0 p-8 opacity-10 pointer-events-none"><i :class="['fa-solid text-6xl md:text-8xl', currentSmartTabIcon]"></i></div><div v-if="currentSmartTab === 'tech'" class="cyber-inner absolute inset-0 -z-10"></div><div class="flex items-center gap-2 mb-4 md:mb-6 border-b border-black/10 dark:border-white/10 pb-3 relative z-10"><i class="fa-solid fa-microchip text-lg" :class="currentTheme.summaryTitle"></i><h3 :class="['text-sm md:text-base font-bold uppercase tracking-widest', currentTheme.summaryTitle]">AI æ ¸å¿ƒç»¼è¿°</h3></div><div class="relative z-10 space-y-6"><template v-if="structuredSummary.length > 0"><div v-for="(section, idx) in structuredSummary" :key="idx" class="group"><h4 v-if="section.title" :class="['text-sm md:text-base font-bold mb-3 flex items-center gap-2', currentTheme.summaryTitle]"><span class="w-1.5 h-1.5 rounded-full bg-current opacity-60"></span>{{ section.title }}</h4><ul class="space-y-3"><li v-for="(point, pIdx) in section.items" :key="pIdx" :class="['text-sm md:text-[15px] leading-relaxed flex items-start gap-2.5', currentTheme.summaryText]"><span class="mt-1.5 w-1.5 h-1.5 rounded-full shrink-0 bg-current opacity-40"></span><span class="text-justify">{{ point }}</span></li></ul></div></template><p v-else :class="['text-sm md:text-base leading-relaxed font-medium text-justify whitespace-pre-wrap', currentTheme.summaryText]">{{ computedSummary }}</p></div></div>
                
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 md:gap-6"><div v-for="(item, idx) in computedItems" :key="idx" :class="['group rounded-xl p-5 md:p-6 transition-all relative overflow-hidden active:scale-[0.98]', isRead(item.title) ? 'read-item' : '', currentTheme.itemCard]"><div v-if="currentSmartTab === 'tech'" class="absolute inset-0 border border-cyan-500/30 rounded-xl pointer-events-none group-hover:border-cyan-400/60 transition-all"></div><div class="flex justify-between items-start gap-4 mb-3 relative z-10"><div><div class="flex flex-wrap items-center gap-2 mb-2"><span v-if="item.sentiment || item.prediction" :class="['px-2 py-0.5 rounded-md text-[10px] md:text-xs font-bold uppercase tracking-wider', getTagStyle(item)]"><i :class="getTagIcon(item)"></i> {{ sentimentTranslate(item.sentiment) || 'æœªæ¥é¢„æµ‹' }}</span><span v-if="item.impact || item.special_note" class="px-2 py-0.5 rounded-md text-[10px] md:text-xs font-medium bg-black/5 dark:bg-white/10 text-slate-600 dark:text-slate-300 flex items-center gap-1"><i :class="['fa-solid', item.special_note ? 'fa-star text-yellow-500' : 'fa-crosshairs opacity-50']"></i>{{ item.impact || item.special_note }}</span></div><h3 :class="['text-lg md:text-xl font-bold leading-tight group-hover:text-blue-500 transition-colors', currentTheme.itemTitle]">{{ item.title }}</h3></div><button @click.stop="toggleRead(item.title)" class="shrink-0 text-xl md:text-2xl opacity-30 hover:opacity-100 transition-opacity p-1" :class="currentTheme.itemText"><i :class="['fa-regular', isRead(item.title) ? 'fa-circle-check text-green-500 opacity-100' : 'fa-circle']"></i></button></div><p :class="['text-sm leading-relaxed mb-4 line-clamp-4 group-hover:line-clamp-none transition-all relative z-10 text-justify', currentTheme.itemText]">{{ item.summary || item.comment || item.reason }}</p><a :href="item.url" target="_blank" @click.stop :class="['inline-flex items-center gap-1 text-xs font-bold uppercase tracking-widest transition-colors relative z-10', currentTheme.readMoreBtn]">Read Source <i class="fa-solid fa-arrow-right-long ml-1 group-hover:translate-x-1 transition-transform"></i></a></div></div>
                
                <div class="max-w-7xl mx-auto py-8 md:py-12 mt-8 border-t border-slate-200 dark:border-slate-800">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg md:text-xl font-bold text-slate-700 dark:text-slate-200 flex items-center gap-2">
                            <i class="fa-solid fa-comments"></i> è¯»è€…è®¨è®º 
                            <span class="text-xs font-normal opacity-60 ml-2">(30+ä½ä¸åŒèŒä¸šç½‘å‹æ¨¡æ‹Ÿ)</span>
                        </h3>
                        <div v-if="blockedUsers.size > 0" class="relative group/blocked">
                            <button class="text-xs px-3 py-1.5 rounded-full bg-red-100 text-red-600 hover:bg-red-200 dark:bg-red-900/30 dark:text-red-400 transition-colors">
                                <i class="fa-solid fa-user-shield mr-1"></i> å·²å±è”½ {{ blockedUsers.size }} äºº
                            </button>
                            <div class="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 p-2 z-50 hidden group-hover/blocked:block">
                                <div class="text-[10px] text-slate-400 px-2 pb-1 mb-1 border-b dark:border-slate-700">ç‚¹å‡»ç”¨æˆ·è§£é™¤å±è”½</div>
                                <div v-for="user in blockedUsers" :key="user" @click="toggleBlockUser(user)" class="px-2 py-1.5 text-xs rounded hover:bg-slate-100 dark:hover:bg-slate-700 cursor-pointer flex justify-between items-center text-slate-600 dark:text-slate-300">
                                    <span>{{ user }}</span>
                                    <i class="fa-solid fa-rotate-left text-slate-400"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentComments && currentComments.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <template v-for="(comment, cIdx) in filteredComments" :key="comment.name + cIdx">
                            <div class="bg-white dark:bg-slate-800/50 p-4 rounded-xl border border-slate-100 dark:border-slate-700 hover:shadow-md transition-all flex gap-3 relative group">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-slate-200 to-slate-300 dark:from-slate-700 dark:to-slate-600 flex items-center justify-center shrink-0 text-lg">
                                    <i :class="['fa-solid', getAvatarIcon(comment.role)]"></i>
                                </div>
                                <div class="flex-1 min-w-0 pr-6"> <div class="flex justify-between items-start mb-1">
                                        <div>
                                            <span class="font-bold text-sm text-slate-800 dark:text-slate-200">{{ comment.name }}</span>
                                            <span class="text-xs text-slate-500 ml-2 px-1.5 py-0.5 rounded bg-slate-100 dark:bg-slate-700">{{ comment.role }}</span>
                                        </div>
                                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-blue-50 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400 font-medium">{{ comment.emotion }}</span>
                                    </div>
                                    <p class="text-sm text-slate-600 dark:text-slate-300 leading-relaxed">{{ comment.content }}</p>
                                </div>

                                <div class="absolute top-4 right-3">
                                    <button @click.stop="toggleMenu(cIdx)" class="text-slate-300 hover:text-slate-500 dark:text-slate-600 dark:hover:text-slate-400 p-1 rounded-full transition-colors">
                                        <i class="fa-solid fa-ellipsis-vertical"></i>
                                    </button>
                                    
                                    <transition name="menu">
                                        <div v-if="activeCommentMenu === cIdx" class="absolute right-0 top-6 w-36 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-slate-200 dark:border-slate-700 py-1 z-20 origin-top-right">
                                            <button @click.stop="toggleBlockUser(comment.name)" class="w-full text-left px-4 py-2 text-xs text-red-600 dark:text-red-400 hover:bg-slate-50 dark:hover:bg-slate-700 flex items-center gap-2">
                                                <i class="fa-solid fa-ban"></i> å±è”½è¯¥è¯»è€…
                                            </button>
                                        </div>
                                    </transition>
                                </div>
                            </div>
                        </template>
                        <div v-if="filteredComments.length === 0 && currentComments.length > 0" class="col-span-full py-8 text-center text-slate-400">
                            æ‰€æœ‰è¯„è®ºå·²è¢«å±è”½
                        </div>
                    </div>
                    <div v-else class="text-center py-10 text-slate-400">
                        <i class="fa-solid fa-spinner fa-spin mr-2"></i> æ­£åœ¨åŠ è½½è¯„è®ºæˆ–æš‚æ— æ•°æ®...
                    </div>
                </div>

            </div>
        </div>

        <div v-if="currentView === 'raw'" class="flex-1 flex flex-col md:flex-row overflow-hidden bg-slate-100 dark:bg-slate-900 transition-colors duration-300">
            <div v-if="showMobileSourceModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm md:hidden" @click="showMobileSourceModal = false"><div class="bg-white dark:bg-slate-800 rounded-2xl w-full max-w-sm max-h-[80vh] flex flex-col shadow-2xl" @click.stop><div class="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center"><h3 class="font-bold text-slate-800 dark:text-white">é€‰æ‹©å…·ä½“æ¥æº</h3><button @click="showMobileSourceModal = false" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-times text-xl"></i></button></div><div class="flex-1 overflow-y-auto p-4 grid grid-cols-2 gap-3"><button v-for="pid in allPlatformIds" :key="pid" @click="selectPlatformFromModal(pid)" class="px-3 py-2 text-sm bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-700 dark:text-slate-200 truncate text-center hover:bg-blue-100 dark:hover:bg-blue-900/30">{{ getDisplayName(pid) }}</button></div></div></div>
            <div class="w-full md:w-48 bg-white dark:bg-slate-800 border-b md:border-b-0 md:border-r border-slate-200 dark:border-slate-700 flex flex-col shrink-0 transition-colors duration-300"><div class="p-3 md:p-4"><h3 class="hidden md:block text-xs font-bold uppercase text-slate-400 mb-4 px-2">æ¥æºåˆ†ç±»</h3><div class="flex items-center gap-2 overflow-x-auto hide-scrollbar pb-1 md:pb-0 md:flex-col md:gap-1 md:items-stretch"><button @click="showMobileSourceModal = true" class="md:hidden shrink-0 px-3 py-2 rounded-lg text-sm font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 flex items-center gap-2"><i class="fa-solid fa-filter"></i> ç­›é€‰æ¥æº</button><div class="md:hidden w-px h-6 bg-slate-200 dark:bg-slate-700 mx-1 shrink-0"></div><button @click="rawCategory = 'all'" :class="rawNavClass('all') + ' shrink-0'"><span><i class="fa-solid fa-border-all mr-2 opacity-70"></i>å…¨éƒ¨</span><span class="text-xs opacity-50 bg-black/5 dark:bg-white/5 px-1.5 rounded-full ml-2">{{ totalRawSources }}</span></button><button @click="rawCategory = 'fav'" :class="rawNavClass('fav') + ' shrink-0'"><span><i class="fa-solid fa-star mr-2 opacity-70 text-yellow-500"></i>æ”¶è—</span><span class="text-xs opacity-50 bg-black/5 dark:bg-white/5 px-1.5 rounded-full ml-2">{{ favoriteIds.size }}</span></button><div class="hidden md:block my-4 border-t border-slate-100 dark:border-slate-700"></div><button v-for="(count, cat) in rawCategoryCounts" :key="cat" @click="rawCategory = cat" :class="rawNavClass(cat) + ' shrink-0'"><span><i :class="['fa-solid mr-2 opacity-70', getCategoryIcon(cat)]"></i><span class="capitalize">{{cat}}</span></span><span class="text-xs opacity-50 ml-2">{{ count }}</span></button></div></div></div>
            <div class="flex-1 flex flex-col overflow-hidden"><div class="p-3 md:p-4 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 flex items-center justify-between transition-colors duration-300"><div class="relative w-full md:w-96"><i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i><input v-model="searchText" type="text" placeholder="æœç´¢æ¥æº (å¦‚: å¾®åš, 36kr)..." class="w-full pl-10 pr-4 py-2 bg-slate-100 dark:bg-slate-900 border-transparent focus:border-blue-500 focus:bg-white dark:focus:bg-slate-950 rounded-lg text-sm transition-all outline-none dark:text-slate-200 placeholder-slate-400"></div><div class="hidden md:block text-sm text-slate-500">æ˜¾ç¤º {{ filteredRawList.length }} ä¸ªæ¥æº</div></div><div class="flex-1 overflow-y-auto p-4 md:p-6 thin-scrollbar bg-slate-50 dark:bg-slate-900 transition-colors duration-300"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 items-start"><div v-for="platform in filteredRawList" :key="platform.id" class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col overflow-hidden hover:shadow-md transition-shadow group"><div class="p-3 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50 flex justify-between items-center shrink-0"><div class="font-bold text-sm flex items-center gap-2 text-slate-700 dark:text-slate-200"><span class="w-2.5 h-2.5 rounded-full" :class="getCategoryColorClass(platform.category)"></span><span class="truncate max-w-[150px] md:max-w-[120px]" :title="platform.id">{{ getDisplayName(platform.id) }}</span></div><div class="flex items-center gap-3"><span class="text-[10px] font-medium bg-slate-200 dark:bg-slate-700 px-1.5 py-0.5 rounded text-slate-500 dark:text-slate-400">{{ platform.items.length }}</span><button @click.stop="toggleFavorite(platform.id)" class="text-lg transition-transform active:scale-125 hover:scale-110"><i :class="['fa-star', isFavorite(platform.id) ? 'fa-solid text-yellow-400' : 'fa-regular text-slate-300 hover:text-yellow-400']"></i></button></div></div><div class="p-3 overflow-y-auto thin-scrollbar" style="max-height: 320px;"><ul class="space-y-2.5"><li v-for="(news, idx) in platform.items" :key="idx" class="group/item"><a :href="news.url" target="_blank" @click.stop class="flex gap-2 items-start leading-tight"><span class="text-[10px] text-slate-400 font-mono pt-0.5 w-4 shrink-0">{{ idx + 1 }}.</span><span class="text-xs text-slate-600 dark:text-slate-300 group-hover/item:text-blue-600 dark:group-hover/item:text-blue-400 group-hover/item:underline break-words">{{ news.title }}</span></a></li></ul></div></div></div></div></div></div>

        <div v-if="currentView === 'contact'" class="flex-1 overflow-y-auto p-4 md:p-8 bg-slate-50 dark:bg-slate-900 transition-colors duration-300">
            <div class="max-w-4xl mx-auto space-y-8">
                
                <div class="text-center py-8">
                    <h1 class="text-3xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-600 mb-4 font-cyber tracking-tight">
                        Insight Pro
                    </h1>
                    <p class="text-slate-500 dark:text-slate-400 text-lg">AI é©±åŠ¨çš„å…¨ç½‘èˆ†æƒ…æ™ºåº“ Â· å®æ—¶æ´å¯Ÿ Â· å¤šç»´æ¨¡æ‹Ÿ</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 relative">
                    <div class="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-slate-200 dark:bg-slate-700 -z-10 -translate-y-1/2 rounded"></div>
                    
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700 text-center relative hover:-translate-y-1 transition-transform">
                        <div class="w-12 h-12 mx-auto bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl mb-3"><i class="fa-solid fa-tower-broadcast"></i></div>
                        <h3 class="font-bold text-slate-800 dark:text-white mb-1">1. å…¨ç½‘é‡‡é›†</h3>
                        <p class="text-xs text-slate-500">æ¯ 2 å°æ—¶è‡ªåŠ¨æŠ“å–<br>39 ä¸ªä¸»æµå¹³å°çƒ­æœ</p>
                    </div>
                    
                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700 text-center relative hover:-translate-y-1 transition-transform">
                        <div class="w-12 h-12 mx-auto bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-xl mb-3"><i class="fa-solid fa-brain"></i></div>
                        <h3 class="font-bold text-slate-800 dark:text-white mb-1">2. æ·±åº¦ç ”åˆ¤</h3>
                        <p class="text-xs text-slate-500">æ¯å¤© 6:00 AM<br>AI èšåˆåˆ†æå››å¤§æ¿å—</p>
                    </div>

                    <div class="bg-white dark:bg-slate-800 p-6 rounded-xl shadow-lg border border-slate-100 dark:border-slate-700 text-center relative hover:-translate-y-1 transition-transform">
                        <div class="w-12 h-12 mx-auto bg-rose-100 text-rose-600 rounded-full flex items-center justify-center text-xl mb-3"><i class="fa-solid fa-people-group"></i></div>
                        <h3 class="font-bold text-slate-800 dark:text-white mb-1">3. èˆ†æƒ…æ¨¡æ‹Ÿ</h3>
                        <p class="text-xs text-slate-500">30+ ä¸åŒäººè®¾/èŒä¸š<br>AI æ¨¡æ‹ŸçœŸå®è¯„è®º</p>
                    </div>
                </div>

                <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 md:p-8">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2 text-slate-800 dark:text-white">
                        <span class="w-1.5 h-6 bg-indigo-500 rounded-full"></span> å¹³å°ä»·å€¼ä¸ç”¨é€”
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="flex gap-4">
                            <i class="fa-solid fa-layer-group text-2xl text-indigo-500 mt-1"></i>
                            <div>
                                <h4 class="font-bold text-slate-700 dark:text-slate-200">ğŸ” ä¿¡æ¯èšåˆ</h4>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1 leading-relaxed">å‘Šåˆ«åœ¨å‡ åä¸ªAppé—´é¢‘ç¹åˆ‡æ¢ã€‚æˆ‘ä»¬æ±‡é›†äº†å¾®åšã€çŸ¥ä¹ã€36æ°ªã€è´¢è”ç¤¾ã€GitHubç­‰39ä¸ªå¤´éƒ¨å¹³å°çš„çƒ­ç‚¹ï¼Œä¸€ç«™å¼æŒæ¡å…¨ç½‘åŠ¨æ€ã€‚</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <i class="fa-solid fa-user-graduate text-2xl text-emerald-500 mt-1"></i>
                            <div>
                                <h4 class="font-bold text-slate-700 dark:text-slate-200">ğŸ“ å­¦æœ¯ä¸ç¤¾ä¼šå­¦å‚è€ƒ</h4>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1 leading-relaxed">é€šè¿‡ AI æ¨¡æ‹Ÿ 30+ ç§ä¸åŒç¤¾ä¼šé˜¶å±‚ï¼ˆä»é¦–å¯Œåˆ°å­¦ç”Ÿï¼‰çš„è§†è§’ï¼Œä¸ºç¤¾ä¼šå¿ƒç†å­¦ç ”ç©¶ã€èˆ†æƒ…æ¨æ¼”æä¾›ç‹¬ç‰¹çš„æ¨¡æ‹Ÿæ ·æœ¬ã€‚</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <i class="fa-solid fa-bolt text-2xl text-amber-500 mt-1"></i>
                            <div>
                                <h4 class="font-bold text-slate-700 dark:text-slate-200">âš¡ å†³ç­–è¾…åŠ©</h4>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1 leading-relaxed">è·¨å¢ƒç”µå•†å•†å®¶å¯å…³æ³¨æ±‡ç‡æ”¿ç­–ï¼Œè‚¡æ°‘å¯å…³æ³¨å¸‚åœºæƒ…ç»ªã€‚AI æç‚¼çš„æ ¸å¿ƒç»¼è¿°å¸®åŠ©ä½ å¿«é€Ÿè¿‡æ»¤å™ªéŸ³ï¼ŒæŠ“ä½å…³é”®ä¿¡æ¯ã€‚</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <i class="fa-solid fa-robot text-2xl text-cyan-500 mt-1"></i>
                            <div>
                                <h4 class="font-bold text-slate-700 dark:text-slate-200">ğŸ¤– Prompt å·¥ç¨‹ç¤ºä¾‹</h4>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1 leading-relaxed">è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„è‡ªåŠ¨åŒ– AI Agent å®è·µé¡¹ç›®ã€‚å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ GitHub Actions å’Œ Gemini API æ„å»ºå…¨è‡ªåŠ¨åŒ–çš„å†…å®¹ç”Ÿäº§æµã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-900 rounded-2xl p-6 md:p-8 text-center border border-slate-200 dark:border-slate-700">
                    <h2 class="text-xl font-bold mb-6 text-slate-800 dark:text-white">è”ç³»ä½œè€… & åŠ å…¥ç¤¾åŒº</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                         <div class="group bg-white dark:bg-slate-700 p-4 rounded-xl shadow-sm hover:shadow-md transition-all cursor-pointer flex flex-col items-center gap-2" @click="copyToClipboard('HunQian_OP', 'å¾®ä¿¡')">
                            <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-lg"><i class="fa-brands fa-weixin"></i></div>
                            <div class="text-center"><p class="text-xs text-slate-400 uppercase font-bold">å¾®ä¿¡</p><p class="font-mono font-medium text-slate-700 dark:text-slate-200 text-sm">HunQian_OP</p></div>
                        </div>
                        <div class="group bg-white dark:bg-slate-700 p-4 rounded-xl shadow-sm hover:shadow-md transition-all cursor-pointer flex flex-col items-center gap-2" @click="copyToClipboard('1441527537', 'QQ')">
                            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-lg"><i class="fa-brands fa-qq"></i></div>
                            <div class="text-center"><p class="text-xs text-slate-400 uppercase font-bold">QQ</p><p class="font-mono font-medium text-slate-700 dark:text-slate-200 text-sm">1441527537</p></div>
                        </div>
                        <div class="group bg-white dark:bg-slate-700 p-4 rounded-xl shadow-sm hover:shadow-md transition-all cursor-pointer flex flex-col items-center gap-2" @click="copyToClipboard('821367583', 'QQç¾¤')">
                            <div class="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-lg"><i class="fa-solid fa-users"></i></div>
                            <div class="text-center"><p class="text-xs text-slate-400 uppercase font-bold">QQ äº¤æµç¾¤</p><p class="font-mono font-medium text-slate-700 dark:text-slate-200 text-sm">821367583</p></div>
                        </div>
                        <div class="group bg-white dark:bg-slate-700 p-4 rounded-xl shadow-sm hover:shadow-md transition-all cursor-pointer flex flex-col items-center gap-2" @click="copyToClipboard('1441527537@qq.com', 'é‚®ç®±')">
                            <div class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-lg"><i class="fa-regular fa-envelope"></i></div>
                            <div class="text-center"><p class="text-xs text-slate-400 uppercase font-bold">Email</p><p class="font-mono font-medium text-slate-700 dark:text-slate-200 text-xs break-all">1441527537@qq.com</p></div>
                        </div>
                    </div>
                </div>

                <p class="text-center text-xs text-slate-400 pb-4">Â© 2025 Insight Pro. Powered by Gemini & GitHub Actions.</p>
            </div>
        </div>
    </main>
</div>

<script>
    const { createApp, reactive, computed, ref, onMounted } = Vue

    createApp({
        setup() {
            const loading = ref(true);
            const isDarkMode = ref(false);
            const isMobileMenuOpen = ref(false); 
            const showMobileSourceModal = ref(false);
            const currentView = ref('smart');
            const currentSmartTab = ref('finance');
            const rawCategory = ref('all');
            const searchText = ref('');
            const lastUpdateTime = ref('');
            const onlineUsers = ref(Math.floor(Math.random() * (500 - 50 + 1)) + 50);

            // å±è”½åŠŸèƒ½ç›¸å…³çŠ¶æ€
            const blockedUsers = reactive(new Set());
            const activeCommentMenu = ref(null); // å­˜å‚¨å½“å‰æ‰“å¼€èœå•çš„è¯„è®ºç´¢å¼•

            const simulateTraffic = () => {
                const delay = Math.floor(Math.random() * 6000) + 2000; 
                setTimeout(() => {
                    const r = Math.random();
                    let diff = 0;
                    if (r > 0.85) { diff = Math.floor(Math.random() * 30) + 10; if (Math.random() > 0.4) diff = -diff; } 
                    else if (r > 0.3) { diff = Math.floor(Math.random() * 5) + 1; if (Math.random() > 0.5) diff = -diff; } 
                    let newVal = onlineUsers.value + diff;
                    if (newVal < 50) newVal = 50; if (newVal > 500) newVal = 500;
                    onlineUsers.value = newVal; simulateTraffic();
                }, delay);
            };

            const smartData = reactive({ finance: null, global: null, tech: null, general: null });
            const rawData = reactive({ finance: [], global: [], tech: [], general: [] });
            const commentsData = reactive({ finance: [], global: [], tech: [], general: [] });
            
            const favoriteIds = reactive(new Set());
            const readSet = reactive(new Set());

            const platformMap = {
                'douyin': 'æŠ–éŸ³', 'zhihu': 'çŸ¥ä¹', 'weibo': 'å¾®åš', 'bilibili-hot-search': 'Bç«™çƒ­æœ', 
                'baidu': 'ç™¾åº¦çƒ­æœ', 'toutiao': 'ä»Šæ—¥å¤´æ¡', 'tieba': 'ç™¾åº¦è´´å§', '36kr-quick': '36æ°ªå¿«è®¯', 
                '36kr-renqi': '36æ°ªäººæ°”', 'wallstreetcn-hot': 'åå°”è¡—è§é—»', 'wallstreetcn-news': 'åå°”è¡—èµ„è®¯', 
                'wallstreetcn-quick': 'åå°”è¡—å¿«è®¯', 'cls-hot': 'è´¢è”ç¤¾çƒ­é—¨', 'cls-depth': 'è´¢è”ç¤¾æ·±åº¦', 
                'xueqiu-hotstock': 'é›ªçƒçƒ­è‚¡', 'gelonghui': 'æ ¼éš†æ±‡', 'jin10': 'é‡‘åæ•°æ®', 'thepaper': 'æ¾æ¹ƒæ–°é—»', 
                'sspai': 'å°‘æ•°æ´¾', 'ithome': 'ITä¹‹å®¶', 'huxiu': 'è™å—…', 'geekpark': 'æå®¢å…¬å›­', 
                'zaobao': 'è”åˆæ—©æŠ¥', 'cankaoxiaoxi': 'å‚è€ƒæ¶ˆæ¯', 'fastbull-express': 'æ³•å¸ƒè´¢ç»', 
                'douban': 'è±†ç“£', 'hupu': 'è™æ‰‘', 'steam': 'Steam', 'v2ex-share': 'V2EX', 'solidot': 'Solidot', 
                'hackernews': 'HackerNews', 'github-trending-today': 'GitHub æ¦œ', 'producthunt': 'ProductHunt'
            };

            const getDisplayName = (id) => platformMap[id] || id; 
            const sentimentTranslate = (s) => ({ 'Bullish': 'åˆ©å¥½', 'Bearish': 'åˆ©ç©º', 'Neutral': 'ä¸­æ€§', 'Mixed': 'éœ‡è¡' }[s] || s);

            const smartTabs = [
                { id: 'finance', name: 'è´¢ç»/å¸‚åœº', icon: 'fa-coins', activeClass: 'text-amber-600 border-amber-600 dark:text-amber-400 dark:border-amber-400' },
                { id: 'global', name: 'å›½é™…/å®è§‚', icon: 'fa-globe', activeClass: 'text-blue-600 border-blue-600 dark:text-blue-400 dark:border-blue-400' },
                { id: 'tech', name: 'ç§‘æŠ€/AI', icon: 'fa-microchip', activeClass: 'text-cyan-600 border-cyan-600 dark:text-cyan-400 dark:border-cyan-400' },
                { id: 'general', name: 'å¨±ä¹/åƒç“œ', icon: 'fa-fire', activeClass: 'text-rose-600 border-rose-600 dark:text-rose-400 dark:border-rose-400' },
            ];

            async function safeFetch(url) {
                try {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return await res.json();
                } catch (e) { return { error: e.message, items: [], comments: [] }; } 
            }
            
            const switchView = (view) => {
                currentView.value = view;
                isMobileMenuOpen.value = false;
            };

            const copyToClipboard = (text, label) => {
                navigator.clipboard.writeText(text).then(() => alert(`${label} å·²å¤åˆ¶ï¼š${text}`)).catch(err => console.error('å¤åˆ¶å¤±è´¥:', err));
            };

            onMounted(async () => {
                loadLocalStorage();
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    isDarkMode.value = true;
                    document.documentElement.classList.add('dark');
                }
                simulateTraffic();

                const t = new Date().getTime();
                loading.value = true;
                
                smartData.finance = await safeFetch(`./analysis_finance.json?t=${t}`);
                smartData.global = await safeFetch(`./analysis_global.json?t=${t}`);
                smartData.tech = await safeFetch(`./analysis_tech.json?t=${t}`);
                smartData.general = await safeFetch(`./analysis_general.json?t=${t}`);
                
                const fData = await safeFetch(`./data_finance.json?t=${t}`); rawData.finance = Array.isArray(fData) ? fData : [];
                const gData = await safeFetch(`./data_global.json?t=${t}`); rawData.global = Array.isArray(gData) ? gData : [];
                const tData = await safeFetch(`./data_tech.json?t=${t}`); rawData.tech = Array.isArray(tData) ? tData : [];
                const genData = await safeFetch(`./data_general.json?t=${t}`); rawData.general = Array.isArray(genData) ? genData : [];

                const cf = await safeFetch(`./comments_finance.json?t=${t}`); commentsData.finance = cf.comments || [];
                const cg = await safeFetch(`./comments_global.json?t=${t}`); commentsData.global = cg.comments || [];
                const ct = await safeFetch(`./comments_tech.json?t=${t}`); commentsData.tech = ct.comments || [];
                const cgen = await safeFetch(`./comments_general.json?t=${t}`); commentsData.general = cgen.comments || [];

                const anyData = smartData.finance || smartData.tech;
                if (anyData?.date) lastUpdateTime.value = anyData.date;
                
                loading.value = false;
            });

            const currentSmartData = computed(() => smartData[currentSmartTab.value]);
            const currentComments = computed(() => commentsData[currentSmartTab.value]);
            
            // è®¡ç®—è¿‡æ»¤åçš„è¯„è®ºï¼ˆæ’é™¤å·²å±è”½ç”¨æˆ·ï¼‰
            const filteredComments = computed(() => {
                if (!currentComments.value) return [];
                return currentComments.value.filter(c => !blockedUsers.has(c.name));
            });

            const computedItems = computed(() => {
                const data = currentSmartData.value;
                if (!data) return [];
                if (Array.isArray(data.items) && data.items.length > 0) return data.items;
                if (data.categories) { for (const key in data.categories) { if (Array.isArray(data.categories[key]) && data.categories[key].length > 0) return data.categories[key]; } }
                return [];
            });

            const computedSummary = computed(() => {
                const d = currentSmartData.value;
                return d ? (d.summary || d.economy_summary) : null;
            });

            const structuredSummary = computed(() => {
                const raw = computedSummary.value;
                if (!raw) return [];
                const sections = raw.split(/(?=ã€)/).filter(s => s.trim());
                return sections.map(section => {
                    const titleMatch = section.match(/ã€(.*?)ã€‘/);
                    const title = titleMatch ? titleMatch[1] : '';
                    let content = section.replace(/ã€.*?ã€‘/, '').trim();
                    // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹ï¼šæ£€æµ‹ (1) (2) (3) ç±»å‹çš„æ¢è¡Œ
                    let items = content.split(/(?=\s*\(\d+\))/).map(i => i.trim()).filter(i => i.length > 2);
                    if (items.length === 0 && content) items = [content];
                    return { title, items };
                }).filter(s => s.title || s.items.length > 0);
            });

            const currentTheme = computed(() => {
                const dark = isDarkMode.value;
                const tab = currentSmartTab.value;
                const view = currentView.value;
                const common = {
                    sidebarBg: dark ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200',
                    sidebarText: dark ? 'text-slate-100' : 'text-slate-800',
                    sidebarBorder: dark ? 'border-slate-800' : 'border-slate-200',
                    sidebarHover: dark ? 'hover:bg-slate-800' : 'hover:bg-slate-100',
                    headerBg: dark ? 'bg-slate-900/80' : 'bg-white/80',
                    headerBorder: dark ? 'border-slate-800' : 'border-slate-200',
                    headerText: dark ? 'text-slate-100' : 'text-slate-800',
                    tabBorder: dark ? 'border-slate-800' : 'border-slate-200',
                    itemText: dark ? 'text-slate-300' : 'text-slate-600',
                };
                if (view === 'raw' || view === 'contact') return { ...common, logoBg: 'bg-slate-200 text-slate-600', logoText: '', mainBg: dark? 'bg-slate-950':'bg-slate-100' };
                const themes = {
                    finance: { ...common, logoBg: 'bg-amber-500', logoText: 'text-amber-950', mainBg: dark ? 'bg-[#0f172a]' : 'bg-[#f8fafc]', summaryCard: dark ? 'bg-gradient-to-br from-slate-800 to-slate-900 border border-amber-500/20 text-amber-50' : 'bg-white border-t-4 border-amber-500 shadow-amber-100', summaryTitle: 'text-amber-500', summaryText: dark ? 'text-amber-100/90' : 'text-slate-700', itemCard: dark ? 'bg-slate-800/50 border-slate-700 hover:border-amber-500/50' : 'bg-white border-slate-200 hover:border-amber-400 hover:shadow-lg', itemTitle: dark ? 'text-slate-100' : 'text-slate-800', readMoreBtn: 'text-amber-500 hover:text-amber-600' },
                    global: { ...common, logoBg: 'bg-blue-600', logoText: 'text-white', mainBg: dark ? 'bg-slate-900' : 'bg-slate-50', summaryCard: dark ? 'bg-blue-900/30 border border-blue-500/30 text-blue-50' : 'bg-gradient-to-r from-blue-50 to-white border border-blue-100', summaryTitle: 'text-blue-500', summaryText: dark ? 'text-blue-100' : 'text-blue-900', itemCard: dark ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200 hover:border-blue-300 hover:shadow', itemTitle: dark ? 'text-white' : 'text-slate-900', readMoreBtn: 'text-blue-500 hover:text-blue-700' },
                    tech: { ...common, logoBg: 'bg-cyan-500 shadow-cyan-500/50', logoText: 'text-cyan-950', mainBg: dark ? 'bg-[#09090b]' : 'bg-slate-100', summaryCard: 'cyber-border text-cyan-50', summaryTitle: 'text-cyan-400 animate-pulse-neon', summaryText: 'text-cyan-50/90 font-mono', itemCard: 'bg-slate-900/80 border-cyan-900/50 hover:bg-slate-900', itemTitle: 'text-cyan-50 font-mono tracking-wider', itemText: 'text-slate-300 font-mono', readMoreBtn: 'text-cyan-400 hover:text-cyan-300 font-mono' },
                    general: { ...common, logoBg: 'bg-gradient-to-br from-rose-500 to-indigo-600', logoText: 'text-white', mainBg: dark ? 'bg-[#1a1218]' : 'bg-[#fff0f5]', summaryCard: 'bg-gradient-to-r from-rose-500 to-indigo-600 text-white shadow-lg shadow-rose-500/30', summaryTitle: 'text-rose-200', summaryText: 'text-white font-medium', itemCard: 'ent-card hover:shadow-xl hover:-translate-y-2', itemTitle: dark ? 'text-white' : 'text-slate-800', readMoreBtn: 'text-indigo-500 hover:text-indigo-700' }
                };
                return themes[tab];
            });

            const currentSmartTabIcon = computed(() => smartTabs.find(t => t.id === currentSmartTab.value)?.icon);
            const currentViewTitle = computed(() => {
                if (currentView.value === 'smart') return smartTabs.find(t => t.id === currentSmartTab.value)?.name;
                if (currentView.value === 'raw') return 'å…¨ç½‘åŸå§‹æ•°æ®ç›‘æ§å°';
                if (currentView.value === 'contact') return 'å…³äº / è”ç³»';
            });

            const allPlatformList = computed(() => [
                ...rawData.finance.map(i => ({ ...i, category: 'finance' })),
                ...rawData.global.map(i => ({ ...i, category: 'global' })),
                ...rawData.tech.map(i => ({ ...i, category: 'tech' })),
                ...rawData.general.map(i => ({ ...i, category: 'general' }))
            ]);
            const allPlatformIds = computed(() => Array.from(new Set(allPlatformList.value.map(p => p.id))).sort());
            const selectPlatformFromModal = (pid) => { searchText.value = getDisplayName(pid); showMobileSourceModal.value = false; };

            const filteredRawList = computed(() => {
                let allRaw = allPlatformList.value;
                if (rawCategory.value === 'fav') allRaw = allRaw.filter(item => favoriteIds.has(item.id));
                else if (rawCategory.value !== 'all') allRaw = allRaw.filter(item => item.category === rawCategory.value);
                if (searchText.value.trim()) {
                    const key = searchText.value.toLowerCase();
                    allRaw = allRaw.filter(item => getDisplayName(item.id).toLowerCase().includes(key) || item.id.toLowerCase().includes(key));
                }
                return allRaw.sort((a, b) => {
                    const aFav = favoriteIds.has(a.id), bFav = favoriteIds.has(b.id);
                    if (aFav && !bFav) return -1; if (!aFav && bFav) return 1;
                    return a.id.localeCompare(b.id);
                });
            });

            const rawCategoryCounts = computed(() => ({ finance: rawData.finance.length, global: rawData.global.length, tech: rawData.tech.length, general: rawData.general.length }));
            const totalRawSources = computed(() => Object.values(rawCategoryCounts.value).reduce((a, b) => a + b, 0));

            const navBtnClass = (view) => `w-full text-left px-4 py-3 rounded-xl flex items-center gap-4 transition-all font-medium ${currentView.value === view ? (isDarkMode.value ? 'bg-slate-800 text-white shadow-inner' : 'bg-slate-100 text-slate-900 shadow-sm') : (isDarkMode.value ? 'text-slate-400 hover:bg-slate-800/50' : 'text-slate-500 hover:bg-slate-50')}`;
            const rawNavClass = (cat) => `w-full text-left px-3 py-2 rounded-lg text-sm font-medium flex items-center justify-between transition-colors capitalize ${rawCategory.value === cat ? 'bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100' : 'text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700'}`;

            const toggleDarkMode = () => { isDarkMode.value = !isDarkMode.value; document.documentElement.classList.toggle('dark', isDarkMode.value); localStorage.setItem('darkMode', isDarkMode.value); };
            const isFavorite = (id) => favoriteIds.has(id);
            const toggleFavorite = (id) => { favoriteIds.has(id) ? favoriteIds.delete(id) : favoriteIds.add(id); saveLocalStorage(); };
            const isRead = (title) => readSet.has(title);
            const toggleRead = (title) => { readSet.has(title) ? readSet.delete(title) : readSet.add(title); saveLocalStorage(); };
            
            // å±è”½ç›¸å…³æ–¹æ³•
            const toggleBlockUser = (name) => {
                if(blockedUsers.has(name)) blockedUsers.delete(name);
                else blockedUsers.add(name);
                activeCommentMenu.value = null; // å…³é—­èœå•
                saveLocalStorage();
            };
            
            const toggleMenu = (idx) => {
                activeCommentMenu.value = activeCommentMenu.value === idx ? null : idx;
            };

            const closeAllMenus = () => {
                activeCommentMenu.value = null;
            };

            const saveLocalStorage = () => { 
                localStorage.setItem('favorites', JSON.stringify([...favoriteIds])); 
                localStorage.setItem('readItems', JSON.stringify([...readSet])); 
                localStorage.setItem('blockedUsers', JSON.stringify([...blockedUsers])); // ä¿å­˜å±è”½åˆ—è¡¨
            };
            
            const loadLocalStorage = () => {
                const fav = localStorage.getItem('favorites'); if (fav) new Set(JSON.parse(fav)).forEach(id => favoriteIds.add(id));
                const read = localStorage.getItem('readItems'); if (read) new Set(JSON.parse(read)).forEach(id => readSet.add(id));
                const blocked = localStorage.getItem('blockedUsers'); if (blocked) new Set(JSON.parse(blocked)).forEach(u => blockedUsers.add(u)); // åŠ è½½å±è”½åˆ—è¡¨
                const dark = localStorage.getItem('darkMode'); if (dark === 'true') isDarkMode.value = true;
            };

            const getTagStyle = (item) => {
                if (item.sentiment === 'Bullish') return 'bg-red-100 text-red-700 border border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800';
                if (item.sentiment === 'Bearish') return 'bg-green-100 text-green-700 border border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800';
                if (item.prediction) return 'bg-cyan-100 text-cyan-700 border border-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-400 dark:border-cyan-800';
                return 'bg-slate-100 text-slate-600 border border-slate-200 dark:bg-slate-800 dark:text-slate-400 dark:border-slate-700';
            };
            const getTagIcon = (item) => item.sentiment === 'Bullish' ? 'fa-solid fa-arrow-trend-up mr-1' : (item.sentiment === 'Bearish' ? 'fa-solid fa-arrow-trend-down mr-1' : 'fa-solid fa-tag mr-1');
            const getCategoryIcon = (cat) => ({ finance: 'fa-coins', global: 'fa-globe', tech: 'fa-microchip', general: 'fa-fire' }[cat] || 'fa-circle');
            const getCategoryColorClass = (cat) => ({ finance: 'bg-amber-500', global: 'bg-blue-500', tech: 'bg-cyan-500', general: 'bg-rose-500' }[cat] || 'bg-slate-500');

            const getAvatarIcon = (role) => {
                if(role.includes('å¸æœº')) return 'fa-taxi';
                if(role.includes('å­¦ç”Ÿ') || role.includes('è€ƒç ”')) return 'fa-graduation-cap';
                if(role.includes('å¤§å¦ˆ') || role.includes('ä¸»å¦‡')) return 'fa-basket-shopping';
                if(role.includes('å¤§å‚') || role.includes('ç¨‹åºå‘˜') || role.includes('åšä¸»')) return 'fa-laptop-code';
                if(role.includes('åŒ»ç”Ÿ')) return 'fa-user-doctor';
                if(role.includes('æˆ¿ä¸œ') || role.includes('æš´å‘æˆ·') || role.includes('è€æ¿') || role.includes('å•†å®¶')) return 'fa-sack-dollar';
                if(role.includes('æ•™å¸ˆ') || role.includes('è€å¸ˆ')) return 'fa-chalkboard-user';
                if(role.includes('é‡‘è') || role.includes('è‚¡æ°‘')) return 'fa-chart-line';
                if(role.includes('å¤–å–')) return 'fa-motorcycle';
                if(role.includes('å·¥åœ°')) return 'fa-helmet-safety';
                if(role.includes('å¥èº«')) return 'fa-dumbbell';
                if(role.includes('ä¹æ‰‹')) return 'fa-guitar';
                if(role.includes('äºŒæ¬¡å…ƒ') || role.includes('å®…ç”·')) return 'fa-gamepad';
                if(role.includes('é¦–å¯Œ') || role.includes('é©¬æ–¯å…‹') || role.includes('é©¬äº‘')) return 'fa-crown';
                if(role.includes('å¤±ä¸š')) return 'fa-user-injured';
                return 'fa-user'; 
            };

            return {
                loading, isDarkMode, isMobileMenuOpen, showMobileSourceModal, currentView, currentSmartTab, rawCategory, searchText, lastUpdateTime,
                smartData, filteredRawList, favoriteIds, rawCategoryCounts, totalRawSources, onlineUsers, allPlatformIds, currentComments,
                smartTabs, currentTheme, currentSmartTabIcon, currentViewTitle, computedSummary, computedItems, structuredSummary,
                navBtnClass, rawNavClass, toggleDarkMode, isFavorite, toggleFavorite, isRead, toggleRead, switchView, selectPlatformFromModal, copyToClipboard,
                getTagStyle, getTagIcon, getCategoryIcon, getCategoryColorClass, getDisplayName, sentimentTranslate, getAvatarIcon,
                // æ–°å¢/ä¿®æ”¹åçš„è¿”å›
                blockedUsers, filteredComments, activeCommentMenu, toggleBlockUser, toggleMenu, closeAllMenus
            }
        }
    }).mount('#app')
</script>
</body>
</html>
